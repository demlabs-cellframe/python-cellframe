# üß™ Python Cellframe SDK - Testing Guide

## üöÄ –ù–æ–≤—ã–π Workflow –¥–ª—è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ù–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å CI/CD, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø–æ–¥—Ö–æ–¥:

### üìã –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–¥–∏–Ω —Ä–∞–∑)
./tests/init_test_environment.sh

# 2. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
./run_tests.sh
```

### üìã –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

```bash
# 1. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
mkdir -p build && cd build
cmake .. -DBUILD_TESTS=ON
make -j$(nproc)

# 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cd ..
./tests/init_test_environment.sh

# 3. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
cd build
ctest --output-on-failure
```

## üîß –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

–°–∫—Ä–∏–ø—Ç `./tests/init_test_environment.sh` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É:

### üêç Python –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- –°–æ–∑–¥–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ `venv_test/`
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ pip, setuptools, wheel
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (pytest, coverage, etc.)
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ (mypy, black, flake8)

### üì¶ –ü–∞–∫–µ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
- –°–æ–±–∏—Ä–∞–µ—Ç –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `python-dap` (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å)
- –°–æ–±–∏—Ä–∞–µ—Ç –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `python-cellframe`
- –ö–æ–ø–∏—Ä—É–µ—Ç –Ω–∞—Ç–∏–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (.so —Ñ–∞–π–ª—ã)
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—É—Ç–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º

### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –°–æ–∑–¥–∞–µ—Ç `venv_test/bin/activate_test` —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ –ø—É—Ç—è–º–∏
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- –°–æ–∑–¥–∞–µ—Ç —É–¥–æ–±–Ω—ã–π —Å–∫—Ä–∏–ø—Ç `run_tests.sh` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

## üéõÔ∏è –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### üîç Verbose —Ä–µ–∂–∏–º (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
```bash
VERBOSE=true ./tests/init_test_environment.sh
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ pip –∏ venv –æ–ø–µ—Ä–∞—Ü–∏–π.

### ü§ñ CI —Ä–µ–∂–∏–º
```bash
CI=true ./tests/init_test_environment.sh
```
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç verbose —Ä–µ–∂–∏–º –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è CI/CD.

### üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
```bash
FORCE_REBUILD=true ./tests/init_test_environment.sh
```
–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –ø–∞–∫–µ—Ç—ã.

## üìä –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

–ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ç–µ—Å—Ç—ã:

### Unit —Ç–µ—Å—Ç—ã
```bash
# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ unit —Ç–µ—Å—Ç–∞
cd build && ctest -R test_unit

# –í—Å–µ unit —Ç–µ—Å—Ç—ã
cd build && ctest -R "test_unit.*"
```

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
# –ë—ã—Å—Ç—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
cd build && ctest -R test_quick_functionality

# –ü–æ–ª–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã  
cd build && ctest -R test_all_python
```

### Legacy —Ç–µ—Å—Ç—ã
```bash
# –¢–µ—Å—Ç—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
cd build && ctest -R test_unit_legacy
```

### Composer —Ç–µ—Å—Ç—ã
```bash
# –¢–µ—Å—Ç—ã composer –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
cd build && ctest -R test_unit_composer
```

## üêõ –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º—ã —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º
```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
FORCE_REBUILD=true ./tests/init_test_environment.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–∞—Ü–∏—é
source venv_test/bin/activate_test
python -c "import CellFrame; print('OK')"
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –Ω–∞—Ç–∏–≤–Ω—ã–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫
ls -la build/libpython_cellframe.so*
ls -la build/dap-sdk-build/libdap_sdk.so*

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Ç–∏
source venv_test/bin/activate_test
echo $LD_LIBRARY_PATH
```

### Verbose –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bash
# –ó–∞–ø—É—Å–∫ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
VERBOSE=true ./tests/init_test_environment.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
source venv_test/bin/activate_test
pip list | grep -E "(cellframe|dap)"
```

## ‚ùå –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥)

### ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ
```bash
# –°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ —á–µ—Ä–µ–∑ CTest fixture (—É–¥–∞–ª–µ–Ω)
ctest  # –±–µ–∑ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ - –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å

# –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫ –±–µ–∑ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
cd build && ctest  # –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–∞–º–∏ –∏–º–ø–æ—Ä—Ç–∞
```

–°—Ç–∞—Ä—ã–π `cellframe_environment_setup` —Ç–µ—Å—Ç –±—ã–ª —É–¥–∞–ª–µ–Ω –∫–∞–∫ –Ω–µ–Ω–∞–¥–µ–∂–Ω—ã–π.

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. **üöÄ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω–µ CTest
2. **üìä –í–∏–¥–∏–º–æ—Å—Ç—å** - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç  
3. **üîß –ì–∏–±–∫–æ—Å—Ç—å** - –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –æ—Ç–¥–µ–ª—å–Ω–æ
4. **‚ö° –°–∫–æ—Ä–æ—Å—Ç—å** - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–¥–∏–Ω —Ä–∞–∑, —Ç–µ—Å—Ç—ã –º–Ω–æ–≥–æ —Ä–∞–∑
5. **üêõ –û—Ç–ª–∞–¥–∫–∞** - –ª–µ–≥–∫–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å VERBOSE=true

## üîÑ CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–î–ª—è CI/CD –ø–∞–π–ø–ª–∞–π–Ω–æ–≤:

```yaml
# –ü—Ä–∏–º–µ—Ä –¥–ª—è GitLab CI
test_python:
  script:
    - mkdir -p build && cd build
    - cmake .. -DBUILD_TESTS=ON
    - make -j$(nproc)
    - cd ..
    - CI=true ./tests/init_test_environment.sh
    - ./run_tests.sh
```

```bash
# –ü—Ä–∏–º–µ—Ä –¥–ª—è GitHub Actions  
- name: Setup test environment
  run: CI=true ./tests/init_test_environment.sh
  
- name: Run tests
  run: ./run_tests.sh
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Ç–µ—Å—Ç–∞–º–∏:

1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ CMake —Å–±–æ—Ä–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å `VERBOSE=true`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —Å–µ–∫—Ü–∏–∏ "Verifying test environment"
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –Ω–∞—Ç–∏–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Å–æ–±—Ä–∞–Ω—ã

---

**–í–∞–∂–Ω–æ:** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –ü–û–°–õ–ï —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞, –Ω–æ –î–û –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤.